"use strict";const{__:__,_x:_x,_n:_n,_nx:_nx}=wp.i18n;jQuery(document).ready(function(o){o("body").on("update-environment.slfw",function(i){const e=o('[name="woocommerce_loggi-shipping_environment"]').val();o("[data-slfw-environment-field]").each(function(i,n){const a=o(this).attr("data-slfw-environment-field")===e;o(this).parents("tr").toggle(a),o(this).prop("required",a)})}),o('[name="woocommerce_loggi-shipping_environment"]').on("change",function(i){o("body").trigger("update-environment.slfw")}),o("body").trigger("update-environment.slfw"),o("body").on("change",".slfw-working-day-input input",function(i){const e=o(this).parents(".slfw-working-day-input"),n=e.siblings("input"),a=e.find(".input-active").prop("checked"),t=e.find(".input-start-time.input-hour"),p=e.find(".input-start-time.input-minute"),r=e.find(".input-end-time.input-hour"),s=e.find(".input-end-time.input-minute"),l=(o,i=59,e=0)=>{let n=parseInt(o.val().replace(/\D/g,""));return(!n||n<e)&&(n=e),n>i&&(n=i),n=n.toString().padStart(2,"0"),o.val(n),n};const d=`${a?"1":"0"}|${l(t,23)}:${l(p)}|${l(r,23)}:${l(s)}`;n.val(d),t.prop("disabled",!a),p.prop("disabled",!a),r.prop("disabled",!a),s.prop("disabled",!a)}),o("body").on("change",".loggi-api-input",function(i){const e=o('[name="woocommerce_loggi-shipping_environment"]').val(),n=o('[name="woocommerce_loggi-shipping_'+e+'_api_email"]').val(),a=o('[name="woocommerce_loggi-shipping_'+e+'_api_key"]').val();n&&a&&(o("#slfw-reload-shops-description").show(),o("#woocommerce_loggi-shipping_shop").find("option").remove(),o("#woocommerce_loggi-shipping_shop").append('<option value="">'+__("Reload your stores.","shipping-loggi-for-woocommerce")+"</option>"))}),o("body").on("click","#slfw-reload-shops-description a",function(i){i.preventDefault();const e=o("#woocommerce_loggi-shipping_shop");e.find("option").remove(),e.append('<option value="0">'+__("Loading...","shipping-loggi-for-woocommerce")+"</option>");const n=o('[name="woocommerce_loggi-shipping_environment"]').val(),a=o('[name="woocommerce_loggi-shipping_'+n+'_api_email"]').val(),t=o('[name="woocommerce_loggi-shipping_'+n+'_api_key"]').val();o.ajax({url:ajaxurl,type:"POST",data:{action:"slfw_all_shops_as_options",environment:n,api_email:a,api_key:t,nonce:e.data("nonce")}}).done(o=>{if(e.find("option").remove(),o.success&&o.data)for(var i=0;i<o.data.length;i++)e.append('<option value="'+o.data[i].value+'">'+o.data[i].label+"</option>");else e.append('<option value="0">'+__("You have any available shop.","shipping-loggi-for-woocommerce")+"</option>")}).fail(()=>{e.find("option").remove(),e.append('<option value="0">'+__("You have any available shop.","shipping-loggi-for-woocommerce")+"</option>")})}),o(".slfw-request-api-key").on("click",function(i){i.preventDefault();const e=o(this).parents("tr").find("input"),n=(o,i="")=>{e.siblings(".description").find(".slfw-request-description").remove(),o&&e.siblings(".description").prepend('<span class="slfw-request-description '+i+'">'+o+"</span>")};n(""),e.removeClass("slfw-invalid-input");const a=e.val();if(!a)return n(__('You should insert your Loggi password in "API Key" field.',"shipping-loggi-for-woocommerce"),"error"),void e.addClass("slfw-invalid-input");const t=o('[name="'+e.data("email-input")+'"]').val();if(!t)return n(__('You should insert your Loggi e-mail in "E-mail" field.',"shipping-loggi-for-woocommerce"),"error"),void e.addClass("slfw-invalid-input");n(__("Loading...","shipping-loggi-for-woocommerce")),o.ajax({url:ajaxurl,type:"POST",data:{action:"slfw_request_api_key",email:t,password:a,environment:e.data("environment"),nonce:e.data("nonce")}}).done(o=>{if(o.success&&o.data)return n(__("API Key found. Save the new settings.","shipping-loggi-for-woocommerce")),void e.val(o.data);o.data?n(o.data,"error"):n(__("Error: please reload the page and try again.","shipping-loggi-for-woocommerce"),"error")}).fail(()=>{n(__("Impossible to request your API Key. Please try again in few minutes.","shipping-loggi-for-woocommerce"),"error")})})});